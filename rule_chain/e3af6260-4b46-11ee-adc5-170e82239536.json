{
  "entityType" : "RULE_CHAIN",
  "entity" : {
    "additionalInfo" : {
      "description" : ""
    },
    "configuration" : null,
    "debugMode" : false,
    "externalId" : {
      "entityType" : "RULE_CHAIN",
      "id" : "e3af6260-4b46-11ee-adc5-170e82239536"
    },
    "firstRuleNodeId" : {
      "entityType" : "RULE_NODE",
      "id" : "329b0070-88f8-11ee-ace3-afcb18c2767c"
    },
    "id" : {
      "entityType" : "RULE_CHAIN",
      "id" : "e3af6260-4b46-11ee-adc5-170e82239536"
    },
    "name" : "EnergyConsumption",
    "root" : false,
    "type" : "CORE"
  },
  "metaData" : {
    "connections" : [ {
      "fromIndex" : 0,
      "toIndex" : 1,
      "type" : "Success"
    }, {
      "fromIndex" : 0,
      "toIndex" : 2,
      "type" : "Success"
    }, {
      "fromIndex" : 0,
      "toIndex" : 7,
      "type" : "Success"
    }, {
      "fromIndex" : 0,
      "toIndex" : 8,
      "type" : "Success"
    }, {
      "fromIndex" : 0,
      "toIndex" : 9,
      "type" : "Success"
    }, {
      "fromIndex" : 1,
      "toIndex" : 3,
      "type" : "Success"
    }, {
      "fromIndex" : 2,
      "toIndex" : 29,
      "type" : "Success"
    }, {
      "fromIndex" : 2,
      "toIndex" : 37,
      "type" : "Success"
    }, {
      "fromIndex" : 4,
      "toIndex" : 21,
      "type" : "Success"
    }, {
      "fromIndex" : 5,
      "toIndex" : 25,
      "type" : "Success"
    }, {
      "fromIndex" : 7,
      "toIndex" : 6,
      "type" : "True"
    }, {
      "fromIndex" : 8,
      "toIndex" : 30,
      "type" : "Success"
    }, {
      "fromIndex" : 8,
      "toIndex" : 40,
      "type" : "Success"
    }, {
      "fromIndex" : 9,
      "toIndex" : 15,
      "type" : "Success"
    }, {
      "fromIndex" : 10,
      "toIndex" : 11,
      "type" : "Success"
    }, {
      "fromIndex" : 11,
      "toIndex" : 32,
      "type" : "Success"
    }, {
      "fromIndex" : 11,
      "toIndex" : 49,
      "type" : "Success"
    }, {
      "fromIndex" : 12,
      "toIndex" : 24,
      "type" : "Success"
    }, {
      "fromIndex" : 14,
      "toIndex" : 12,
      "type" : "Success"
    }, {
      "fromIndex" : 16,
      "toIndex" : 17,
      "type" : "Success"
    }, {
      "fromIndex" : 17,
      "toIndex" : 35,
      "type" : "Success"
    }, {
      "fromIndex" : 17,
      "toIndex" : 52,
      "type" : "Success"
    }, {
      "fromIndex" : 18,
      "toIndex" : 19,
      "type" : "Success"
    }, {
      "fromIndex" : 19,
      "toIndex" : 28,
      "type" : "Success"
    }, {
      "fromIndex" : 21,
      "toIndex" : 22,
      "type" : "Success"
    }, {
      "fromIndex" : 22,
      "toIndex" : 31,
      "type" : "Success"
    }, {
      "fromIndex" : 22,
      "toIndex" : 43,
      "type" : "Success"
    }, {
      "fromIndex" : 23,
      "toIndex" : 10,
      "type" : "Success"
    }, {
      "fromIndex" : 24,
      "toIndex" : 33,
      "type" : "Success"
    }, {
      "fromIndex" : 24,
      "toIndex" : 55,
      "type" : "Success"
    }, {
      "fromIndex" : 25,
      "toIndex" : 26,
      "type" : "Success"
    }, {
      "fromIndex" : 26,
      "toIndex" : 34,
      "type" : "Success"
    }, {
      "fromIndex" : 26,
      "toIndex" : 46,
      "type" : "Success"
    }, {
      "fromIndex" : 27,
      "toIndex" : 16,
      "type" : "Success"
    }, {
      "fromIndex" : 28,
      "toIndex" : 36,
      "type" : "Success"
    }, {
      "fromIndex" : 28,
      "toIndex" : 58,
      "type" : "Success"
    }, {
      "fromIndex" : 29,
      "toIndex" : 4,
      "type" : "Success"
    }, {
      "fromIndex" : 30,
      "toIndex" : 5,
      "type" : "Success"
    }, {
      "fromIndex" : 31,
      "toIndex" : 23,
      "type" : "Success"
    }, {
      "fromIndex" : 32,
      "toIndex" : 14,
      "type" : "Success"
    }, {
      "fromIndex" : 33,
      "toIndex" : 13,
      "type" : "Success"
    }, {
      "fromIndex" : 34,
      "toIndex" : 27,
      "type" : "Success"
    }, {
      "fromIndex" : 35,
      "toIndex" : 18,
      "type" : "Success"
    }, {
      "fromIndex" : 36,
      "toIndex" : 20,
      "type" : "Success"
    }, {
      "fromIndex" : 37,
      "toIndex" : 38,
      "type" : "Success"
    }, {
      "fromIndex" : 38,
      "toIndex" : 39,
      "type" : "Success"
    }, {
      "fromIndex" : 40,
      "toIndex" : 41,
      "type" : "Success"
    }, {
      "fromIndex" : 41,
      "toIndex" : 42,
      "type" : "Success"
    }, {
      "fromIndex" : 43,
      "toIndex" : 44,
      "type" : "Success"
    }, {
      "fromIndex" : 44,
      "toIndex" : 45,
      "type" : "Success"
    }, {
      "fromIndex" : 46,
      "toIndex" : 47,
      "type" : "Success"
    }, {
      "fromIndex" : 47,
      "toIndex" : 48,
      "type" : "Success"
    }, {
      "fromIndex" : 49,
      "toIndex" : 50,
      "type" : "Success"
    }, {
      "fromIndex" : 50,
      "toIndex" : 51,
      "type" : "Success"
    }, {
      "fromIndex" : 52,
      "toIndex" : 53,
      "type" : "Success"
    }, {
      "fromIndex" : 53,
      "toIndex" : 54,
      "type" : "Success"
    }, {
      "fromIndex" : 55,
      "toIndex" : 56,
      "type" : "Success"
    }, {
      "fromIndex" : 56,
      "toIndex" : 57,
      "type" : "Success"
    }, {
      "fromIndex" : 58,
      "toIndex" : 59,
      "type" : "Success"
    }, {
      "fromIndex" : 59,
      "toIndex" : 60,
      "type" : "Success"
    } ],
    "firstNodeIndex" : 0,
    "nodes" : [ {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 276,
        "layoutY" : 151
      },
      "configuration" : {
        "originatorSource" : "RELATED",
        "entityType" : null,
        "entityNamePattern" : null,
        "relationsQuery" : {
          "fetchLastLevelOnly" : false,
          "direction" : "TO",
          "maxLevel" : 1,
          "filters" : [ {
            "relationType" : "Contains",
            "entityTypes" : [ "ASSET" ]
          }, {
            "relationType" : null,
            "entityTypes" : [ ]
          } ]
        }
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "329b0070-88f8-11ee-ace3-afcb18c2767c"
      },
      "name" : "To Building Asset",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbChangeOriginatorNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 577,
        "layoutY" : 97
      },
      "configuration" : {
        "direction" : "FROM",
        "relationType" : "Contains",
        "deduplicationInSec" : 10,
        "aggMappings" : [ {
          "sourceScope" : "LATEST_TELEMETRY",
          "source" : "energyConsumption",
          "defaultValue" : 0,
          "aggFunction" : "AVG",
          "target" : "energyConsumptionAvg"
        } ],
        "outMsgType" : "POST_TELEMETRY_REQUEST",
        "queueName" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "329b2780-88f8-11ee-ace3-afcb18c2767c"
      },
      "name" : "Energy Avgerage",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.analytics.latest.telemetry.TbAggLatestTelemetryNodeV2"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 328,
        "layoutY" : 2
      },
      "configuration" : {
        "direction" : "FROM",
        "relationType" : "Contains",
        "deduplicationInSec" : 10,
        "aggMappings" : [ {
          "sourceScope" : "LATEST_TELEMETRY",
          "source" : "energyConsumption",
          "defaultValue" : 0,
          "aggFunction" : "SUM",
          "target" : "powerMonthlyConsumption"
        } ],
        "outMsgType" : "POST_TELEMETRY_REQUEST",
        "queueName" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "329b4e90-88f8-11ee-ace3-afcb18c2767c"
      },
      "name" : "Aggregate Sum",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.analytics.latest.telemetry.TbAggLatestTelemetryNodeV2"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 826,
        "layoutY" : 125
      },
      "configuration" : {
        "defaultTTL" : 0,
        "skipLatestPersistence" : false,
        "useServerTs" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "329b75a0-88f8-11ee-ace3-afcb18c2767c"
      },
      "name" : "Save time series",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1062,
        "layoutY" : 8
      },
      "configuration" : {
        "defaultTTL" : 0,
        "skipLatestPersistence" : false,
        "useServerTs" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "329b9cb0-88f8-11ee-ace3-afcb18c2767c"
      },
      "name" : "Save time series",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1105,
        "layoutY" : 187
      },
      "configuration" : {
        "defaultTTL" : 0,
        "skipLatestPersistence" : false,
        "useServerTs" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "329bc3c0-88f8-11ee-ace3-afcb18c2767c"
      },
      "name" : "powerConsumptionCurrentMonthpersite",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 897,
        "layoutY" : 341
      },
      "configuration" : {
        "alarmType" : "General Alarm",
        "scriptLang" : "TBEL",
        "alarmDetailsBuildJs" : "var details = {};\nif (metadata.prevAlarmDetails) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n    //remove prevAlarmDetails from metadata\n    delete metadata.prevAlarmDetails;\n    //now metadata is the same as it comes IN this rule node\n}\n\n\nreturn details;",
        "alarmDetailsBuildTbel" : "var details = {};\nif (metadata.prevAlarmDetails != null) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n    //remove prevAlarmDetails from metadata\n    metadata.remove('prevAlarmDetails');\n    //now metadata is the same as it comes IN this rule node\n}\n\n\nreturn details;",
        "severity" : "CRITICAL",
        "propagate" : false,
        "propagateToOwner" : false,
        "propagateToOwnerHierarchy" : false,
        "propagateToTenant" : false,
        "useMessageAlarmData" : false,
        "overwriteAlarmDetails" : false,
        "dynamicSeverity" : false,
        "relationTypes" : [ ]
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "329bead0-88f8-11ee-ace3-afcb18c2767c"
      },
      "name" : "Asset alaram",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 604,
        "layoutY" : 322
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return msg.temperature > 20;",
        "tbelScript" : "return msg.energyConsumption > 200;"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "329c11e0-88f8-11ee-ace3-afcb18c2767c"
      },
      "name" : "Script asset alaram",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 606,
        "layoutY" : 155
      },
      "configuration" : {
        "direction" : "FROM",
        "relationType" : "Contains",
        "deduplicationInSec" : 10,
        "aggMappings" : [ {
          "sourceScope" : "LATEST_TELEMETRY",
          "source" : "cost",
          "defaultValue" : 0,
          "aggFunction" : "SUM",
          "target" : "costLatestSum"
        } ],
        "outMsgType" : "POST_TELEMETRY_REQUEST",
        "queueName" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "329c38f0-88f8-11ee-ace3-afcb18c2767c"
      },
      "name" : "aggreagate latest cost total",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.analytics.latest.telemetry.TbAggLatestTelemetryNodeV2"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 557,
        "layoutY" : 226
      },
      "configuration" : {
        "direction" : "FROM",
        "relationType" : "Contains",
        "deduplicationInSec" : 10,
        "aggMappings" : [ {
          "sourceScope" : "LATEST_TELEMETRY",
          "source" : "cost",
          "defaultValue" : 0,
          "aggFunction" : "AVG",
          "target" : "latestAvgcost"
        } ],
        "outMsgType" : "POST_TELEMETRY_REQUEST",
        "queueName" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "329c6000-88f8-11ee-ace3-afcb18c2767c"
      },
      "name" : "Aggregate lastest cost average",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.analytics.latest.telemetry.TbAggLatestTelemetryNodeV2"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1593,
        "layoutY" : 97
      },
      "configuration" : {
        "originatorSource" : "RELATED",
        "entityType" : null,
        "entityNamePattern" : null,
        "relationsQuery" : {
          "fetchLastLevelOnly" : false,
          "direction" : "TO",
          "maxLevel" : 1,
          "filters" : [ {
            "relationType" : "Contains",
            "entityTypes" : [ "CUSTOMER" ]
          } ]
        }
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "329c8710-88f8-11ee-ace3-afcb18c2767c"
      },
      "name" : "Transformation customer",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbChangeOriginatorNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1305,
        "layoutY" : 185
      },
      "configuration" : {
        "direction" : "FROM",
        "relationType" : "Contains",
        "deduplicationInSec" : 10,
        "aggMappings" : [ {
          "sourceScope" : "LATEST_TELEMETRY",
          "source" : "userLatestMonthlyPowerConsumption",
          "defaultValue" : 0,
          "aggFunction" : "SUM",
          "target" : "latestMonthlyPowerConsumption"
        } ],
        "outMsgType" : "POST_TELEMETRY_REQUEST",
        "queueName" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "329c8711-88f8-11ee-ace3-afcb18c2767c"
      },
      "name" : "Aggregate customer consumption",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.analytics.latest.telemetry.TbAggLatestTelemetryNodeV2"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1911,
        "layoutY" : 213
      },
      "configuration" : {
        "originatorSource" : "TENANT",
        "entityType" : null,
        "entityNamePattern" : null,
        "relationsQuery" : {
          "direction" : "FROM",
          "maxLevel" : 1,
          "filters" : [ {
            "relationType" : "Contains",
            "entityTypes" : [ ]
          } ],
          "fetchLastLevelOnly" : false
        }
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "329cae20-88f8-11ee-ace3-afcb18c2767c"
      },
      "name" : "Tenant consumption",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbChangeOriginatorNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 2174,
        "layoutY" : 206
      },
      "configuration" : {
        "defaultTTL" : 0,
        "skipLatestPersistence" : false,
        "useServerTs" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "329cd530-88f8-11ee-ace3-afcb18c2767c"
      },
      "name" : "name time series name",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1659,
        "layoutY" : 184
      },
      "configuration" : {
        "defaultTTL" : 0,
        "skipLatestPersistence" : false,
        "useServerTs" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "329cfc40-88f8-11ee-ace3-afcb18c2767c"
      },
      "name" : "user tenant time series",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 870,
        "layoutY" : 255
      },
      "configuration" : {
        "defaultTTL" : 0,
        "skipLatestPersistence" : false,
        "useServerTs" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "329d2350-88f8-11ee-ace3-afcb18c2767c"
      },
      "name" : "Save Avg aggregate cost",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1189,
        "layoutY" : 365
      },
      "configuration" : {
        "originatorSource" : "CUSTOMER",
        "entityType" : null,
        "entityNamePattern" : null,
        "relationsQuery" : {
          "fetchLastLevelOnly" : false,
          "direction" : "TO",
          "maxLevel" : 1,
          "filters" : [ {
            "relationType" : "Manages",
            "entityTypes" : [ "CUSTOMER" ]
          } ]
        }
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "329d4a60-88f8-11ee-ace3-afcb18c2767c"
      },
      "name" : "Transformation cost customer",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbChangeOriginatorNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1421,
        "layoutY" : 349
      },
      "configuration" : {
        "direction" : "FROM",
        "relationType" : "Contains",
        "deduplicationInSec" : 10,
        "aggMappings" : [ {
          "sourceScope" : "LATEST_TELEMETRY",
          "source" : "userCostLatestSum",
          "defaultValue" : 0,
          "aggFunction" : "SUM",
          "target" : "customerCostLatestSum"
        } ],
        "outMsgType" : "POST_TELEMETRY_REQUEST",
        "queueName" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "329d9880-88f8-11ee-ace3-afcb18c2767c"
      },
      "name" : "Aggregate customer cost consumption",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.analytics.latest.telemetry.TbAggLatestTelemetryNodeV2"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1759,
        "layoutY" : 344
      },
      "configuration" : {
        "defaultTTL" : 0,
        "skipLatestPersistence" : false,
        "useServerTs" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "329d9881-88f8-11ee-ace3-afcb18c2767c"
      },
      "name" : "Save cost aggregate sum at user level",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1877,
        "layoutY" : 273
      },
      "configuration" : {
        "originatorSource" : "TENANT",
        "entityType" : null,
        "entityNamePattern" : null,
        "relationsQuery" : {
          "direction" : "FROM",
          "maxLevel" : 1,
          "filters" : [ {
            "relationType" : "Contains",
            "entityTypes" : [ ]
          } ],
          "fetchLastLevelOnly" : false
        }
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "329de6a0-88f8-11ee-ace3-afcb18c2767c"
      },
      "name" : "Tenant cost consumption",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbChangeOriginatorNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 2152,
        "layoutY" : 279
      },
      "configuration" : {
        "defaultTTL" : 0,
        "skipLatestPersistence" : false,
        "useServerTs" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "329e0db0-88f8-11ee-ace3-afcb18c2767c"
      },
      "name" : "save times series tenant level",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1105,
        "layoutY" : 107
      },
      "configuration" : {
        "originatorSource" : "RELATED",
        "entityType" : null,
        "entityNamePattern" : null,
        "relationsQuery" : {
          "fetchLastLevelOnly" : false,
          "direction" : "TO",
          "maxLevel" : 1,
          "filters" : [ {
            "relationType" : "Contains",
            "entityTypes" : [ "USER" ]
          } ]
        }
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "329e0db1-88f8-11ee-ace3-afcb18c2767c"
      },
      "name" : "Transformation customer",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbChangeOriginatorNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1277,
        "layoutY" : 11
      },
      "configuration" : {
        "direction" : "FROM",
        "relationType" : "Contains",
        "deduplicationInSec" : 10,
        "aggMappings" : [ {
          "sourceScope" : "LATEST_TELEMETRY",
          "source" : "powerMonthlyConsumption",
          "defaultValue" : 0,
          "aggFunction" : "SUM",
          "target" : "userLatestMonthlyPowerConsumption"
        } ],
        "outMsgType" : "POST_TELEMETRY_REQUEST",
        "queueName" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "329e34c0-88f8-11ee-ace3-afcb18c2767c"
      },
      "name" : "Aggregate user consumption",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.analytics.latest.telemetry.TbAggLatestTelemetryNodeV2"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1340,
        "layoutY" : 111
      },
      "configuration" : {
        "defaultTTL" : 0,
        "skipLatestPersistence" : false,
        "useServerTs" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "329e5bd0-88f8-11ee-ace3-afcb18c2767c"
      },
      "name" : "Save time series",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1896,
        "layoutY" : 85
      },
      "configuration" : {
        "direction" : "FROM",
        "relationType" : "Contains",
        "deduplicationInSec" : 10,
        "aggMappings" : [ {
          "sourceScope" : "LATEST_TELEMETRY",
          "source" : "latestMonthlyPowerConsumption",
          "defaultValue" : 0,
          "aggFunction" : "SUM",
          "target" : "latestMonthlyPowerConsumptionTenant"
        } ],
        "outMsgType" : "POST_TELEMETRY_REQUEST",
        "queueName" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "329e82e0-88f8-11ee-ace3-afcb18c2767c"
      },
      "name" : "Aggregate Tenant consumption",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.analytics.latest.telemetry.TbAggLatestTelemetryNodeV2"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1083,
        "layoutY" : 428
      },
      "configuration" : {
        "originatorSource" : "RELATED",
        "entityType" : null,
        "entityNamePattern" : null,
        "relationsQuery" : {
          "fetchLastLevelOnly" : false,
          "direction" : "TO",
          "maxLevel" : 1,
          "filters" : [ {
            "relationType" : "Contains",
            "entityTypes" : [ "USER" ]
          } ]
        }
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "329ea9f0-88f8-11ee-ace3-afcb18c2767c"
      },
      "name" : "Transformation customer",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbChangeOriginatorNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1283,
        "layoutY" : 478
      },
      "configuration" : {
        "direction" : "FROM",
        "relationType" : "Contains",
        "deduplicationInSec" : 10,
        "aggMappings" : [ {
          "sourceScope" : "LATEST_TELEMETRY",
          "source" : "costLatestSum",
          "defaultValue" : 0,
          "aggFunction" : "SUM",
          "target" : "userCostLatestSum"
        } ],
        "outMsgType" : "POST_TELEMETRY_REQUEST",
        "queueName" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "329ed100-88f8-11ee-ace3-afcb18c2767c"
      },
      "name" : "Aggregate user consumption",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.analytics.latest.telemetry.TbAggLatestTelemetryNodeV2"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1652,
        "layoutY" : 467
      },
      "configuration" : {
        "defaultTTL" : 0,
        "skipLatestPersistence" : false,
        "useServerTs" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "329fbb60-88f8-11ee-ace3-afcb18c2767c"
      },
      "name" : "Save time series",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1979,
        "layoutY" : 393
      },
      "configuration" : {
        "direction" : "FROM",
        "relationType" : "Contains",
        "deduplicationInSec" : 10,
        "aggMappings" : [ {
          "sourceScope" : "LATEST_TELEMETRY",
          "source" : "customerCostLatestSum",
          "defaultValue" : 0,
          "aggFunction" : "SUM",
          "target" : "tenantCostLatestSum"
        } ],
        "outMsgType" : "POST_TELEMETRY_REQUEST",
        "queueName" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "329fe271-88f8-11ee-ace3-afcb18c2767c"
      },
      "name" : "Aggregate Tenant consumption",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.analytics.latest.telemetry.TbAggLatestTelemetryNodeV2"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 727,
        "layoutY" : 49
      },
      "configuration" : {
        "inputValueKey" : "powerMonthlyConsumption",
        "outputValueKey" : "deltaPowerMonthlyConsumption",
        "useCache" : true,
        "addPeriodBetweenMsgs" : false,
        "periodValueKey" : "periodInMs",
        "round" : null,
        "tellFailureIfDeltaIsNegative" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "32a00980-88f8-11ee-ace3-afcb18c2767c"
      },
      "name" : "Asset delta Consumption",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.CalculateDeltaNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 845,
        "layoutY" : 181
      },
      "configuration" : {
        "inputValueKey" : "costLatestSum",
        "outputValueKey" : "deltaCostLatestSum",
        "useCache" : true,
        "addPeriodBetweenMsgs" : false,
        "periodValueKey" : "periodInMs",
        "round" : null,
        "tellFailureIfDeltaIsNegative" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "32a03090-88f8-11ee-ace3-afcb18c2767c"
      },
      "name" : "Asset delta cost Consumption",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.CalculateDeltaNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1568,
        "layoutY" : 13
      },
      "configuration" : {
        "inputValueKey" : "userLatestMonthlyPowerConsumption",
        "outputValueKey" : "deltaUserLatestMonthlyPowerConsumption",
        "useCache" : true,
        "addPeriodBetweenMsgs" : false,
        "periodValueKey" : "periodInMs",
        "round" : null,
        "tellFailureIfDeltaIsNegative" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "32a057a0-88f8-11ee-ace3-afcb18c2767c"
      },
      "name" : "Asset delta Consumption",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.CalculateDeltaNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1495,
        "layoutY" : 263
      },
      "configuration" : {
        "inputValueKey" : "latestMonthlyPowerConsumption",
        "outputValueKey" : "deltaLatestMonthlyPowerConsumption",
        "useCache" : true,
        "addPeriodBetweenMsgs" : false,
        "periodValueKey" : "periodInMs",
        "round" : null,
        "tellFailureIfDeltaIsNegative" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "32a07eb0-88f8-11ee-ace3-afcb18c2767c"
      },
      "name" : "Asset delta Consumption",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.CalculateDeltaNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 2113,
        "layoutY" : 91
      },
      "configuration" : {
        "inputValueKey" : "latestMonthlyPowerConsumptionTenant",
        "outputValueKey" : "deltaLatestMonthlyPowerConsumptionTenant",
        "useCache" : true,
        "addPeriodBetweenMsgs" : false,
        "periodValueKey" : "periodInMs",
        "round" : null,
        "tellFailureIfDeltaIsNegative" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "32a0a5c0-88f8-11ee-ace3-afcb18c2767c"
      },
      "name" : "Asset delta Consumption",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.CalculateDeltaNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1495,
        "layoutY" : 540
      },
      "configuration" : {
        "inputValueKey" : "userCostLatestSum",
        "outputValueKey" : "deltaUserCostLatestSum",
        "useCache" : true,
        "addPeriodBetweenMsgs" : false,
        "periodValueKey" : "periodInMs",
        "round" : null,
        "tellFailureIfDeltaIsNegative" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "32a0ccd0-88f8-11ee-ace3-afcb18c2767c"
      },
      "name" : "Asset delta cost Consumption",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.CalculateDeltaNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1588,
        "layoutY" : 404
      },
      "configuration" : {
        "inputValueKey" : "customerCostLatestSum",
        "outputValueKey" : "deltaCustomerCostLatestSum",
        "useCache" : true,
        "addPeriodBetweenMsgs" : false,
        "periodValueKey" : "periodInMs",
        "round" : null,
        "tellFailureIfDeltaIsNegative" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "32a0f3e0-88f8-11ee-ace3-afcb18c2767c"
      },
      "name" : "Asset delta cost Consumption",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.CalculateDeltaNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 2185,
        "layoutY" : 456
      },
      "configuration" : {
        "inputValueKey" : "tenantCostLatestSum",
        "outputValueKey" : "deltaTenantCostLatestSum",
        "useCache" : true,
        "addPeriodBetweenMsgs" : false,
        "periodValueKey" : "periodInMs",
        "round" : null,
        "tellFailureIfDeltaIsNegative" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "32a11af0-88f8-11ee-ace3-afcb18c2767c"
      },
      "name" : "Asset delta cost Consumption",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.CalculateDeltaNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 91,
        "layoutY" : 437
      },
      "configuration" : {
        "latestTsKeyNames" : [ "powerMonthlyConsumption" ],
        "aggregation" : "NONE",
        "fetchMode" : "LAST",
        "orderBy" : "ASC",
        "limit" : 1000,
        "useMetadataIntervalPatterns" : false,
        "startIntervalPattern" : "",
        "endIntervalPattern" : "",
        "startInterval" : 30,
        "startIntervalTimeUnit" : "DAYS",
        "endInterval" : 1,
        "endIntervalTimeUnit" : "SECONDS"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b902b260-a3d4-11ee-8a35-2d562209d378"
      },
      "name" : "current month reading",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetTelemetryNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 370,
        "layoutY" : 435
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : " var newMsg = {};\r\n\r\n   let deltaPowerMonthConsumption = parseFloat(Math.abs(msg.powerMonthlyConsumption - JSON.parse(metadata.powerMonthlyConsumption)).toFixed(2));\r\n   if(deltaPowerMonthConsumption <= 0) { deltaPowerMonthConsumption=0 }\r\n   newMsg.deltaPowerMonthConsumption = deltaPowerMonthConsumption;\r\n\r\n   return {msg: newMsg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b9034ea0-a3d4-11ee-8a35-2d562209d378"
      },
      "name" : "test script",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 692,
        "layoutY" : 442
      },
      "configuration" : {
        "defaultTTL" : 0,
        "skipLatestPersistence" : false,
        "useServerTs" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "206944d0-a3d7-11ee-883f-6bd49e8cfa16"
      },
      "name" : "Save time series",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 87,
        "layoutY" : 503
      },
      "configuration" : {
        "latestTsKeyNames" : [ "costLatestSum" ],
        "aggregation" : "NONE",
        "fetchMode" : "LAST",
        "orderBy" : "ASC",
        "limit" : 1000,
        "useMetadataIntervalPatterns" : false,
        "startIntervalPattern" : "",
        "endIntervalPattern" : "",
        "startInterval" : 30,
        "startIntervalTimeUnit" : "DAYS",
        "endInterval" : 1,
        "endIntervalTimeUnit" : "SECONDS"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b03ed590-a3da-11ee-80a4-b9287a0d2939"
      },
      "name" : "current month reading",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetTelemetryNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 366,
        "layoutY" : 501
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : " var newMsg = {};\r\n\r\n   let deltaCostMonthlySum = parseFloat(Math.abs(msg.costLatestSum - JSON.parse(metadata.costLatestSum)).toFixed(2));\r\n   if(deltaCostMonthlySum <= 0) { deltaCostMonthlySum=0 }\r\n   newMsg.deltaCostMonthlySum = deltaCostMonthlySum;\r\n\r\n   return {msg: newMsg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b0403520-a3da-11ee-80a4-b9287a0d2939"
      },
      "name" : "test script",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 688,
        "layoutY" : 508
      },
      "configuration" : {
        "defaultTTL" : 0,
        "skipLatestPersistence" : false,
        "useServerTs" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b0411f80-a3da-11ee-80a4-b9287a0d2939"
      },
      "name" : "Save time series",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 843,
        "layoutY" : 578
      },
      "configuration" : {
        "latestTsKeyNames" : [ "latestMonthlyPowerConsumption" ],
        "aggregation" : "NONE",
        "fetchMode" : "LAST",
        "orderBy" : "ASC",
        "limit" : 1000,
        "useMetadataIntervalPatterns" : false,
        "startIntervalPattern" : "",
        "endIntervalPattern" : "",
        "startInterval" : 30,
        "startIntervalTimeUnit" : "DAYS",
        "endInterval" : 1,
        "endIntervalTimeUnit" : "SECONDS"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b041e2d0-a3da-11ee-80a4-b9287a0d2939"
      },
      "name" : "current month reading",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetTelemetryNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1111,
        "layoutY" : 580
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : " var newMsg = {};\r\n\r\n   let deltaLatestMonthlyPowerConsumption = parseFloat(Math.abs(msg.latestMonthlyPowerConsumption - JSON.parse(metadata.latestMonthlyPowerConsumption)).toFixed(2));\r\n   if(deltaLatestMonthlyPowerConsumption <= 0) { deltaLatestMonthlyPowerConsumption=0 }\r\n   newMsg.deltaLatestMonthlyPowerConsumption = deltaLatestMonthlyPowerConsumption;\r\n\r\n   return {msg: newMsg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b0427f10-a3da-11ee-80a4-b9287a0d2939"
      },
      "name" : "test script",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1433,
        "layoutY" : 587
      },
      "configuration" : {
        "defaultTTL" : 0,
        "skipLatestPersistence" : false,
        "useServerTs" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b0431b50-a3da-11ee-80a4-b9287a0d2939"
      },
      "name" : "Save time series",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 847,
        "layoutY" : 653
      },
      "configuration" : {
        "latestTsKeyNames" : [ "userCostLatestSum" ],
        "aggregation" : "NONE",
        "fetchMode" : "LAST",
        "orderBy" : "ASC",
        "limit" : 1000,
        "useMetadataIntervalPatterns" : false,
        "startIntervalPattern" : "",
        "endIntervalPattern" : "",
        "startInterval" : 30,
        "startIntervalTimeUnit" : "DAYS",
        "endInterval" : 1,
        "endIntervalTimeUnit" : "SECONDS"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b043b790-a3da-11ee-80a4-b9287a0d2939"
      },
      "name" : "current month reading",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetTelemetryNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1126,
        "layoutY" : 651
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : " var newMsg = {};\r\n\r\n   let deltaUserCostLatestSum = parseFloat(Math.abs(msg.userCostLatestSum - JSON.parse(metadata.userCostLatestSum)).toFixed(2));\r\n   if(deltaUserCostLatestSum <= 0) { deltaUserCostLatestSum=0 }\r\n   newMsg.deltaUserCostLatestSum = deltaUserCostLatestSum;\r\n\r\n   return {msg: newMsg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b04453d0-a3da-11ee-80a4-b9287a0d2939"
      },
      "name" : "test script",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1448,
        "layoutY" : 658
      },
      "configuration" : {
        "defaultTTL" : 0,
        "skipLatestPersistence" : false,
        "useServerTs" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b044f010-a3da-11ee-80a4-b9287a0d2939"
      },
      "name" : "Save time series",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 853,
        "layoutY" : 748
      },
      "configuration" : {
        "latestTsKeyNames" : [ "latestMonthlyPowerConsumption" ],
        "aggregation" : "NONE",
        "fetchMode" : "LAST",
        "orderBy" : "ASC",
        "limit" : 1000,
        "useMetadataIntervalPatterns" : false,
        "startIntervalPattern" : "",
        "endIntervalPattern" : "",
        "startInterval" : 30,
        "startIntervalTimeUnit" : "DAYS",
        "endInterval" : 1,
        "endIntervalTimeUnit" : "SECONDS"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b0458c50-a3da-11ee-80a4-b9287a0d2939"
      },
      "name" : "current month reading",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetTelemetryNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1132,
        "layoutY" : 746
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : " var newMsg = {};\r\n\r\n   let deltaLatestMonthlyPowerConsumption = parseFloat(Math.abs(msg.latestMonthlyPowerConsumption - JSON.parse(metadata.latestMonthlyPowerConsumption)).toFixed(2));\r\n   if(deltaLatestMonthlyPowerConsumption <= 0) { deltaLatestMonthlyPowerConsumption=0 }\r\n   newMsg.deltaLatestMonthlyPowerConsumption = deltaLatestMonthlyPowerConsumption;\r\n\r\n   return {msg: newMsg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b0460180-a3da-11ee-80a4-b9287a0d2939"
      },
      "name" : "test script",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1454,
        "layoutY" : 753
      },
      "configuration" : {
        "defaultTTL" : 0,
        "skipLatestPersistence" : false,
        "useServerTs" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b0469dc0-a3da-11ee-80a4-b9287a0d2939"
      },
      "name" : "Save time series",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 851,
        "layoutY" : 829
      },
      "configuration" : {
        "latestTsKeyNames" : [ "customerCostLatestSum" ],
        "aggregation" : "NONE",
        "fetchMode" : "LAST",
        "orderBy" : "ASC",
        "limit" : 1000,
        "useMetadataIntervalPatterns" : false,
        "startIntervalPattern" : "",
        "endIntervalPattern" : "",
        "startInterval" : 30,
        "startIntervalTimeUnit" : "DAYS",
        "endInterval" : 1,
        "endIntervalTimeUnit" : "SECONDS"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b04712f0-a3da-11ee-80a4-b9287a0d2939"
      },
      "name" : "current month reading",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetTelemetryNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1130,
        "layoutY" : 827
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : " var newMsg = {};\r\n\r\n   let deltaCustomerCostLatestSum = parseFloat(Math.abs(msg.customerCostLatestSum - JSON.parse(metadata.customerCostLatestSum)).toFixed(2));\r\n   if(deltaCustomerCostLatestSum <= 0) { deltaCustomerCostLatestSum=0 }\r\n   newMsg.deltaCustomerCostLatestSum = deltaCustomerCostLatestSum;\r\n\r\n   return {msg: newMsg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b047af30-a3da-11ee-80a4-b9287a0d2939"
      },
      "name" : "test script",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1452,
        "layoutY" : 834
      },
      "configuration" : {
        "defaultTTL" : 0,
        "skipLatestPersistence" : false,
        "useServerTs" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b0482460-a3da-11ee-80a4-b9287a0d2939"
      },
      "name" : "Save time series",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1718,
        "layoutY" : 555
      },
      "configuration" : {
        "latestTsKeyNames" : [ "latestMonthlyPowerConsumptionTenant" ],
        "aggregation" : "NONE",
        "fetchMode" : "LAST",
        "orderBy" : "ASC",
        "limit" : 1000,
        "useMetadataIntervalPatterns" : false,
        "startIntervalPattern" : "",
        "endIntervalPattern" : "",
        "startInterval" : 30,
        "startIntervalTimeUnit" : "DAYS",
        "endInterval" : 1,
        "endIntervalTimeUnit" : "SECONDS"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b0489990-a3da-11ee-80a4-b9287a0d2939"
      },
      "name" : "current month reading",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetTelemetryNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1997,
        "layoutY" : 553
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : " var newMsg = {};\r\n\r\n   let deltaLatestMonthlyPowerConsumptionTenant\r\n = parseFloat(Math.abs(msg.latestMonthlyPowerConsumptionTenant\r\n - JSON.parse(metadata.latestMonthlyPowerConsumptionTenant)).toFixed(2));\r\n   if(deltaLatestMonthlyPowerConsumptionTenant <= 0) { deltaLatestMonthlyPowerConsumptionTenant=0 }\r\n   newMsg.deltaLatestMonthlyPowerConsumptionTenant = deltaLatestMonthlyPowerConsumptionTenant;\r\n\r\n   return {msg: newMsg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b04935d0-a3da-11ee-80a4-b9287a0d2939"
      },
      "name" : "test script",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 2319,
        "layoutY" : 560
      },
      "configuration" : {
        "defaultTTL" : 0,
        "skipLatestPersistence" : false,
        "useServerTs" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b049f920-a3da-11ee-80a4-b9287a0d2939"
      },
      "name" : "Save time series",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1703,
        "layoutY" : 696
      },
      "configuration" : {
        "latestTsKeyNames" : [ "tenantCostLatestSum" ],
        "aggregation" : "NONE",
        "fetchMode" : "LAST",
        "orderBy" : "ASC",
        "limit" : 1000,
        "useMetadataIntervalPatterns" : false,
        "startIntervalPattern" : "",
        "endIntervalPattern" : "",
        "startInterval" : 30,
        "startIntervalTimeUnit" : "DAYS",
        "endInterval" : 1,
        "endIntervalTimeUnit" : "SECONDS"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b04a9560-a3da-11ee-80a4-b9287a0d2939"
      },
      "name" : "current month reading",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetTelemetryNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1982,
        "layoutY" : 694
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : " var newMsg = {};\r\n\r\n   let deltaTenantCostLatestSum = parseFloat(Math.abs(msg.tenantCostLatestSum - JSON.parse(metadata.tenantCostLatestSum)).toFixed(2));\r\n   if(deltaTenantCostLatestSum <= 0) { deltaTenantCostLatestSum=0 }\r\n   newMsg.deltaTenantCostLatestSum = deltaTenantCostLatestSum;\r\n\r\n   return {msg: newMsg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b04b31a0-a3da-11ee-80a4-b9287a0d2939"
      },
      "name" : "test script",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 2304,
        "layoutY" : 701
      },
      "configuration" : {
        "defaultTTL" : 0,
        "skipLatestPersistence" : false,
        "useServerTs" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b04bcde1-a3da-11ee-80a4-b9287a0d2939"
      },
      "name" : "Save time series",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    } ],
    "ruleChainConnections" : null
  },
  "relations" : [ ],
  "attributes" : {
    "SERVER_SCOPE" : [ ]
  }
}